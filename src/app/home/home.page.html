<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Delights</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Delights</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="ion-padding">
    <div class="question-text">
      <h2>Wie f√ºhlst du dich gerade?</h2>
    </div>
    <div class="emoji-card">
      <div class="card-content">
        <div class="emoji-grid">
          <div class="emoji-row">
            <span class="emoji-item" *ngFor="let emoji of emojis.slice(0, 4)" (click)="onEmojiClick(emoji)">{{emoji}}</span>
          </div>
          <div class="emoji-row">
            <span class="emoji-item" *ngFor="let emoji of emojis.slice(4, 8)" (click)="onEmojiClick(emoji)">{{emoji}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Delight-Liste -->
    <div class="delights-section" *ngIf="existingDelights.length > 0">
      <h3>Deine Delights</h3>
      <ion-list>
        <ion-card *ngFor="let delight of existingDelights" class="delight-card clickable-card" (click)="openDelightDetail(delight)">
          <ion-card-header>
            <div class="delight-header">
              <span class="delight-emoji">{{ delight.emoji }}</span>
              <div class="delight-meta">
                <small class="delight-date">{{ formatDate(delight.createdAt) }}</small>
              </div>
            </div>
          </ion-card-header>
          <ion-card-content *ngIf="delight.description">
            <p class="delight-description">{{ delight.description }}</p>
          </ion-card-content>
          <ion-card-content *ngIf="delight.imageBase64" class="image-content">
            <img [src]="delight.imageBase64" alt="Delight Bild" class="delight-image">
          </ion-card-content>
        </ion-card>
      </ion-list>
    </div>

    <!-- Nachricht wenn keine Delights vorhanden -->
    <div class="no-delights" *ngIf="existingDelights.length === 0">
      <p>Noch keine Delights vorhanden. W√§hle ein Emoji oben aus, um dein erstes Delight zu erstellen!</p>
    </div>
  </div>

  <!-- Modal f√ºr Delight-Eingabe -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Delight hinzuf√ºgen</ion-title>
          <ion-buttons slot="end">
            <ion-button fill="clear" (click)="closeModal()">
              Abbrechen
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <div class="modal-content">
          <div class="emoji-display">
            <span class="selected-emoji">{{ selectedEmoji }}</span>
          </div>

          <ion-item>
            <ion-label position="stacked">Beschreibung (optional)</ion-label>
            <ion-textarea
              [(ngModel)]="description"
              placeholder="Was hat dir gefallen? Beschreibe dein Delight..."
              rows="4">
            </ion-textarea>
          </ion-item>

          <!-- Foto-Sektion -->
          <div class="photo-section">
            <ion-label>
              <h3>Foto hinzuf√ºgen (optional)</h3>
            </ion-label>

            <!-- Foto-Buttons -->
            <div class="photo-buttons" *ngIf="!capturedImage">
              <ion-button
                fill="outline"
                color="primary"
                (click)="capturePhoto()"
                class="photo-button">
                üì∑ Foto aufnehmen
              </ion-button>
              <ion-button
                fill="outline"
                color="secondary"
                (click)="selectFromGallery()"
                class="photo-button">
                üñºÔ∏è Aus Galerie w√§hlen
              </ion-button>
            </div>

            <!-- Bildvorschau -->
            <div class="image-preview" *ngIf="capturedImage">
              <img [src]="capturedImage" alt="Ausgew√§hltes Bild" class="preview-image">
              <ion-button
                fill="clear"
                color="danger"
                (click)="removeImage()"
                class="remove-image-button">
                ‚ùå Bild entfernen
              </ion-button>
            </div>
          </div>

          <div class="button-container">
            <ion-button
              expand="block"
              color="primary"
              (click)="saveDelight()">
              Speichern
            </ion-button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Detail-Modal f√ºr Delights -->
  <app-delight-detail-modal
    [delight]="selectedDelight!"
    [isOpen]="isDetailModalOpen"
    *ngIf="selectedDelight"
    (didDismiss)="closeDetailModal()">
  </app-delight-detail-modal>
</ion-content>
