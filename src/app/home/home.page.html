<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Delight</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Delight</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Emoji-Auswahl -->
  <div class="emoji-grid">
    <button
      *ngFor="let emoji of emojis"
      class="emoji-button"
      (click)="onEmojiClick(emoji)">
      {{emoji}}
    </button>
  </div>

  <!-- Bestehende Delights -->
  <ion-list *ngIf="existingDelights.length > 0">
    <ion-item
      *ngFor="let delight of existingDelights"
      [button]="true"
      (click)="openDelightDetail(delight)">
      <ion-label>
        <h2>{{delight.emoji}} {{delight.description}}</h2>
        <p>{{formatDate(delight.createdAt)}}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Modal fÃ¼r neues Delight -->
  <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Neues Delight {{selectedEmoji}}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <!-- Kamera-Bereich -->
        <div class="camera-section">
          <!-- Kamera-Vorschau -->
          <div *ngIf="isCameraOpen" class="camera-preview">
            <video #video autoplay playsinline class="camera-video"></video>
            <canvas #canvas style="display: none;"></canvas>

            <div class="camera-controls">
              <ion-button fill="clear" (click)="closeCamera()" color="light" size="default">
                <ion-icon name="close"></ion-icon>
              </ion-button>
              <ion-button fill="solid" (click)="capturePhoto()" color="primary" class="capture-button" size="default">
                <ion-icon name="camera"></ion-icon>
              </ion-button>
              <ion-button fill="clear" (click)="switchCamera()" color="light" size="default" *ngIf="hasMultipleCameras">
                <ion-icon name="camera-reverse"></ion-icon>
              </ion-button>
            </div>
          </div>

          <!-- Aufgenommenes Foto -->
          <div *ngIf="capturedImage && !isCameraOpen" class="captured-image">
            <img [src]="capturedImage" alt="Aufgenommenes Foto" class="preview-image">

            <div class="image-controls">
              <ion-button fill="clear" (click)="removePhoto()" color="danger" size="default">
                <ion-icon name="trash" slot="start"></ion-icon>
                Entfernen
              </ion-button>
              <ion-button fill="clear" (click)="retakePhoto()" color="medium" size="default">
                <ion-icon name="camera" slot="start"></ion-icon>
                Neu aufnehmen
              </ion-button>
            </div>
          </div>

          <!-- Kamera-Button (wenn keine Kamera offen und kein Foto) -->
          <div *ngIf="!isCameraOpen && !capturedImage" class="camera-button-container">
            <ion-button
              *ngIf="isCameraSupported"
              fill="outline"
              (click)="openCamera()"
              class="camera-button"
              size="large">
              <ion-icon name="camera" slot="start"></ion-icon>
              Foto aufnehmen
            </ion-button>

            <!-- Neuer Upload-Button -->
            <ion-button
              fill="outline"
              (click)="triggerFileUpload()"
              class="upload-button"
              size="large">
              <ion-icon name="image" slot="start"></ion-icon>
              Bild hochladen
            </ion-button>

            <p *ngIf="!isCameraSupported" class="camera-not-supported">
              ðŸ“· Kamera wird von diesem GerÃ¤t nicht unterstÃ¼tzt
            </p>
          </div>
        </div>

        <!-- Beschreibung -->
        <ion-item>
          <ion-textarea
            [(ngModel)]="description"
            placeholder="Beschreibung (optional)"
            rows="3"
            autoGrow="true">
          </ion-textarea>
        </ion-item>

        <!-- Speichern-Button -->
        <ion-button
          expand="block"
          (click)="saveDelight()"
          class="save-button">
          <ion-icon name="checkmark" slot="start"></ion-icon>
          Delight speichern
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Detail-Modal -->
  <app-delight-detail-modal
    *ngIf="selectedDelight"
    [isOpen]="isDetailModalOpen"
    [delight]="selectedDelight"
    (didDismiss)="closeDetailModal()">
  </app-delight-detail-modal>
</ion-content>
